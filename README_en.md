# illumiGenerator
Generate Arduino source code for control of illuminations from JSON and simplified-C/C++ setting files.

### To Japanese readers
日本語版READMEは[こちら](README.md)から。

# Caution
illumiGenerator is the tool written for use in our club activities. Readers expected to be member of our Radio Club and understand the hardware specifications.

# Usage

## Summary

```
$ ./illumiGenerator <jsonfile> <outputname>
```

### 1st Argument \<jsonfile\>
illumiGenerator uses the JSON setting files. refer to [Format of JSON File](https://github.com/jj1lis/illumiGenerator/blob/master/README_en.jp#format-of-json-file).

### 2nd Argument \<outputname\>
The name of the `.ino` file generated by illumiGenerator. The extension ant the end isn't automatically added :

```
# example

$ illumiGenerator hoge.json fuga.ino
  # Arduino code "fuga.ino" will be generated.
```

# Format of Files

## Format of JSON File
The whole of the JSON file that illumiGenerator reads **must be ONLY ONE JSON Object, neither too much or nor too little.** 
The operation when it's constituted of multiple JSON Objects is undefined (but exception would be thrown.)

```
{
    "pinMax": 13, 
    "pinMin": 2,
    "pinSW": "A1",

    "flushCycle": 2000,
    "dutyRatio": 0.1,

    "functionSources": [
        "example/func/default.func",
        "example/func/xmas.func",
        "example/func/mochi.func",
        "example/func/oni.func"
    ],  

    "patternOrder" : ["xmas", "mochi", "oni"]
}

```

### List of Elements
|key|type of element|description|
|---|---------------|-----------|
|"pinMax"|unsigned integer|max of pins being used|
|"pinMin"|unsigned integer|min of pins being used|
|"pinSW"|string|pin for the mode switching|
|"flushCycle"|unsigned integer|flushing cycle(millisecound)|
|"dutyRatio"|float|max Duty ratio of output in PWM|
|"functionSources"|array(string)|control function file|
|"patternOrder"|array(string)|list and order of modes|

`"functionSources"` can be multiple and be devided the source code in its contents in any way. However, the names of the modes listed in `"functionSources"` and the `"patternOrder"` must be match.

Also refer this [example](example/example.json).

## Format of Control Function Files 

### Syntax

the control function files are written according to the simplified-C syntax, such as:


```
Jan{
  pin_3-5,9{
    if(0 <= phase && phase <= PI){
      return 1;
    }else{
      return 0;
    }
  }  
}
```

Tag `Jan`, gave on outermost curly bracket, expresses that functions in it is for mode `Jan`.
Functions which have the same tag are be collected in the same mode control.

Following contents in brackets are functions about the operation for each output pins. the name `pin_3-5,9` shows that this function specifies operation at pin `3, 4, 5, 9`.

In other words:
```
Tag{
  pin_a,b-c,d{
    //process A
  }
  
  pin_e-f,g,h{
    //process B
  }
}
```

This source code specifies to run `process A` at pin `a, b ~ c, d`, and `process B` at pin `e ~ f, g, h`.

A variable `phase` is the phase ["flushCycle"](https://github.com/jj1lis/illumiGenerator/blob/master/README_en.md#list-of-elements) moves in the interval [0, 2π].
If you write `return sin(phase);`, the Duty ratio will change smoothly along the sine function in the interval.
The Duty ratio is ["dutyRatio"](https://github.com/jj1lis/illumiGenerator/blob/master/README_en.md#list-of-elements) when `1` is returned, and it doesn't flush at all when `0` is returned.

To say the truth, as implemented, illumiGenerator doesn't do the syntax check, pasting the description in the functions into the output as it is. So please refer [Arduino Official Langhage Reference](https://www.arduino.cc/reference/en/) and more. Good Luck!


### About "Default"
There is the special tag, called "Default" besides ["patternOrder"](https://github.com/jj1lis/illumiGenerator/blob/master/README_en.md#list-of-elements).
For instance tag `ModeA`, described functions about pin `3 ~ 5`, is defined. The whole of pins are `2 ~ 13`.
Other pins usually doesn't works in `ModeA` and are off. However, illumiGenerator compliments operations at pin `2, 6, 7` if functions are written in the tag "Default" (operations at `3 ~5` aren't replaced). 
Pins `8 ~ 13` are always off because their functions are not written anywhere.
